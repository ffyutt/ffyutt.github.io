<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="陈星宇"><meta name="copyright" content="陈星宇"><meta name="generator" content="Hexo 5.4.0"><meta name="theme" content="hexo-theme-yun"><title>linker_script | Keeping</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.24/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_j5gk85dg4pf.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="shortcut icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"ffyutt.github.io","root":"/","title":"ffyutt的小站","version":"1.5.3","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><meta name="description" content="通过对linker script官方文档的整理理解stm32f401的链接文件">
<meta property="og:type" content="article">
<meta property="og:title" content="linker_script">
<meta property="og:url" content="https://ffyutt.github.io/2021/04/arm/linker-script.html">
<meta property="og:site_name" content="Keeping">
<meta property="og:description" content="通过对linker script官方文档的整理理解stm32f401的链接文件">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/fffyutt/image_warehouse/raw/master/img/查看符号表.png">
<meta property="og:image" content="https://gitee.com/fffyutt/image_warehouse/raw/master/img/objdump查看符号表.png">
<meta property="article:published_time" content="2021-04-29T09:14:18.000Z">
<meta property="article:modified_time" content="2021-05-02T10:22:24.470Z">
<meta property="article:author" content="陈星宇">
<meta property="article:tag" content="arm">
<meta property="article:tag" content="linker script">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/fffyutt/image_warehouse/raw/master/img/查看符号表.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="陈星宇"><img width="96" loading="lazy" src="/Yun.png" alt="陈星宇"></a><div class="site-author-name"><a href="/about/">陈星宇</a></div><span class="site-name">Keeping</span><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">6</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">5</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">9</span></a></div><a class="site-state-item hty-icon-button" href="/null" title="设置"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/ffyutt" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="cxy1276018778@163.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.now.sh/" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-send-plane-2-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text"> 基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">2.</span> <span class="toc-text"> 变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E4%B8%8E%E6%93%8D%E4%BD%9C"><span class="toc-number">2.1.</span> <span class="toc-text"> 定义与操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#the-location-counter"><span class="toc-number">2.2.</span> <span class="toc-text"> The Location Counter — .</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E7%9A%84%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">2.3.</span> <span class="toc-text"> 变量的修饰符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#memory"><span class="toc-number">3.</span> <span class="toc-text"> MEMORY</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#section"><span class="toc-number">4.</span> <span class="toc-text"> SECTION</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E6%AE%B5%E6%8F%8F%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text"> 输入段描述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%8F%8F%E8%BF%B0"><span class="toc-number">4.1.1.</span> <span class="toc-text"> 基本描述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#common"><span class="toc-number">4.1.2.</span> <span class="toc-text"> COMMON</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">4.1.3.</span> <span class="toc-text"> 垃圾回收？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">4.1.4.</span> <span class="toc-text"> 直接写入数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E6%AE%B5%E6%8F%8F%E8%BF%B0"><span class="toc-number">4.2.</span> <span class="toc-text"> 输出段描述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.2.1.</span> <span class="toc-text"> 类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AElma"><span class="toc-number">4.2.2.</span> <span class="toc-text"> 设置LMA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#phdr-phdr"><span class="toc-number">4.2.3.</span> <span class="toc-text"> [:phdr :phdr …]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fillexp"><span class="toc-number">4.2.4.</span> <span class="toc-text"> [&#x3D;FILLEXP] [,]</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">5.</span> <span class="toc-text"> 参考文献</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://ffyutt.github.io/2021/04/arm/linker-script.html"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="陈星宇"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Keeping"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">linker_script</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2021-04-29 17:14:18" itemprop="dateCreated datePublished" datetime="2021-04-29T17:14:18+08:00">2021-04-29</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="修改时间：2021-05-02 18:22:24" itemprop="dateModified" datetime="2021-05-02T18:22:24+08:00">2021-05-02</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/arm/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">arm</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/arm/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">arm</span></a><a class="tag-item" href="/tags/linker-script/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">linker script</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><p>​	配置GNU arm环境的时候在链接的部分出bug了，现在基本查不到写的比较完整的对linker script的介绍，所以自己去找了官方文档，希望能够整理出一篇能够帮助自己解决问题的&quot;中文参考手册&quot;吧.自己翻译的，一定还有不足，如有疑问可以查阅<a target="_blank" rel="noopener" href="https://sourceware.org/binutils/docs/ld">ld官方文档</a>。</p>
<h2 id="基本概念"><a class="markdownIt-Anchor" href="#基本概念"></a> 基本概念</h2>
<p>​	链接脚本的操作对象是.o文件，也就是目标文件。对于链接脚本来说，我们写的代码是分段管理的，也就是在arm工具链中定义的AREA，在GNU工具链中定义的.section，段有三种状态，loaded（在允许时该段需要被加载到内存），allocatable（该段的空间需要被留出来，但是不往里面加载内容，可能会清空该片区域，比如bss段），除了前两个之外（不可装载也不分配空间的段通常装着调试信息）。</p>
<p>​	每个段有两个地址，VMA（vitual memory address），指该段的运行时地址；LMA（load memory address），指该段的装载地址。一般来说他们是相同的，不一般的情况比如装入ROM的数据段会在程序启动时拷贝到到RAM中。</p>
<p>​	每个目标文件都有一张符号表，我们可以使用nm或者objdump -t查看符号表。</p>
<img src="https://gitee.com/fffyutt/image_warehouse/raw/master/img/查看符号表.png" alt="查看符号表" style="zoom: 80%;" / loading="lazy">
<img src="https://gitee.com/fffyutt/image_warehouse/raw/master/img/objdump查看符号表.png" alt="objdump查看符号表" style="zoom:80%;" / loading="lazy">
<h2 id="变量"><a class="markdownIt-Anchor" href="#变量"></a> 变量</h2>
<h3 id="定义与操作"><a class="markdownIt-Anchor" href="#定义与操作"></a> 定义与操作</h3>
<p>​	我们可以在链接脚本中定义一些变量来标识各种内存段的开头，结尾，或者任何你想让他在的地方。</p>
<p>​	变量可以通过以下的指令进行定义和修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">symbol &#x3D; expression ;</span><br><span class="line">symbol +&#x3D; expression ;</span><br><span class="line">symbol -&#x3D; expression ;</span><br><span class="line">symbol *&#x3D; expression ;</span><br><span class="line">symbol &#x2F;&#x3D; expression ;</span><br><span class="line">symbol &lt;&lt;&#x3D; expression ;</span><br><span class="line">symbol &gt;&gt;&#x3D; expression ;</span><br><span class="line">symbol &amp;&#x3D; expression ;</span><br><span class="line">symbol |&#x3D; expression ;</span><br></pre></td></tr></table></figure>
<p>​	其中在执行除了第一句定义语句外需要存在该变量才可以执行。</p>
<p>（我在查资料的时候有些地方说不能够重复使用=进行定义会报错，但是没有是试验出问题）</p>
<h3 id="the-location-counter"><a class="markdownIt-Anchor" href="#the-location-counter"></a> The Location Counter — .</h3>
<p>​	变量最常用的是&quot;.&quot;，我们在这部分的介绍中会使用dot来指代&quot;.&quot;。dot代表的是内存分配中当前内存位置，这可以帮助我们在完成段的链接后确定段尾所在的位置，并用其他变量保存段尾位置并为外界提供访问该变量的可能。dot的使用中需要注意的是，当dot被.text等的大括号包围时，在大括号内的dot采用的是相对于开始该段的位置的相对位置，这也可能导致一些问题，我们看如下例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">    . &#x3D; 0x100</span><br><span class="line">    .text: &#123;</span><br><span class="line">      *(.text)</span><br><span class="line">      . &#x3D; 0x200</span><br><span class="line">    &#125;</span><br><span class="line">    . &#x3D; 0x500</span><br><span class="line">    .data: &#123;</span><br><span class="line">      *(.data)</span><br><span class="line">      . +&#x3D; 0x600</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		首先将程序当前位置定义到0x100的位置，开始定义text段的内容，把所有段定义为.text的段放入这块内存区域，随后执行&quot;. = 0x200&quot;将dot从text的开始位置0x100增加0x200的偏移量，注意了，是从该段前定义的开始位置增加0x200，而不是直接跳转到0x200，实际上执行该语句后dot的值为0x300。此时可能会发生一个问题，如果text段的内容比较多，比0x200的范围更大，那么dot就会发生回退，这会导致内存区域的重叠，实际上这是不允许发生的，会报错。随后开始链接data段，运行到&quot;. += 0x600&quot;时，dot会在程序当前位置的基础上再增加了0x600的空间。所以，只有当发生=的定义时才会导致偏移地址的产生，其他情况均不会发生奇怪的事情。</p>
<h3 id="变量的修饰符"><a class="markdownIt-Anchor" href="#变量的修饰符"></a> 变量的修饰符</h3>
<p>HIDDEN(变量定义语句);</p>
<p>​	对于elf格式的文件，用上述方法定义的变量不会被导出（换句话说就是个局部变量，外面访问不到了）</p>
<p>PROVIDE (变量定义语句);</p>
<p>​	使用该语句定义的变量类似于汇编中的[weak]，只有当程序中没有对该定义的内容进行重载时才会使用该语句的赋值。如果没有使用该修饰语法，当链接脚本和程序的其他部分都定义了一个变量，会导致重复定义的错误。</p>
<h2 id="memory"><a class="markdownIt-Anchor" href="#memory"></a> MEMORY</h2>
<p>​	memory关键字主要用于描述内存中目标内存块的区域和大小，换句话说就是，哪里是RAM，有多大，哪里是ROM，有多大。语法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MEMORY </span><br><span class="line">	&#123;</span><br><span class="line">		name[(attr)]:ORIGIN &#x3D; origin, LENGTH &#x3D; len</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>​	其中name是内存块的名字，attr是内存块的访问等的权限（具体参数见后），ORIGIN是该内存块的起始地址，LENGTH是该内存块的长度。</p>
<p>​	attr的可选参数如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">‘R’	Read-only section</span><br><span class="line">‘W’	Read&#x2F;write section</span><br><span class="line">‘X’ Executable section</span><br><span class="line">‘A’ Allocatable section</span><br><span class="line">‘I’	Initialized section</span><br><span class="line">‘L’ Same as ‘I’</span><br><span class="line">‘!’ Invert the sense of any of the attributes that follow</span><br></pre></td></tr></table></figure>
<p>​	给出以STM32F401RE为模板的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MEMORY</span><br><span class="line">&#123;</span><br><span class="line">FLASH(rx)      : ORIGIN &#x3D; 0x08000000, LENGTH &#x3D; 512K</span><br><span class="line">RAM (xrw)      : ORIGIN &#x3D; 0x20000000, LENGTH &#x3D; 96K</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​	我们定义了从0x08000000开始的512k为可读可执行的flash，从0x20000000长度为96k的可读写可执行的RAM段，这些内存段的定义实际上是根据嵌入式设备的物理内存的实际相关的，我们可以在STM32F401RE参考手册中找到这些内容。</p>
<h2 id="section"><a class="markdownIt-Anchor" href="#section"></a> SECTION</h2>
<p>​	section帮助我们定义我们汇编中定义的各种段该放在什么地方，这部分是链接脚本不可缺少的一部分，语法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">*section* [address] [(type)] :</span><br><span class="line">  [AT(lma)]</span><br><span class="line">  [ALIGN(section_align) | ALIGN_WITH_INPUT]</span><br><span class="line">  [SUBALIGN(subsection_align)]</span><br><span class="line">  [constraint]</span><br><span class="line">  &#123;</span><br><span class="line">    output-section-command</span><br><span class="line">    output-section-command</span><br><span class="line">    …</span><br><span class="line">  &#125; [&gt;region] [AT&gt;lma_region] [:phdr :phdr …] [&#x3D;fillexp] [,]</span><br></pre></td></tr></table></figure>
<p>output-section-command有四种:</p>
<p><strong>(1)</strong> ENTRY</p>
<p><strong>(2)</strong> 符号赋值语句</p>
<p><strong>(3)</strong> 一个输出section的描述(output section description)</p>
<p><strong>(4)</strong> 一个section叠加描述(overlay description)</p>
<p>​	region就是前面memory中定义的各个区块（name）</p>
<p>先来个简单的例子看看section部分长什么样子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SECTION:</span><br><span class="line">&#123; &#x2F;*下面这部分用于stm32 cotex-m4的中断向量表的装入*&#x2F;</span><br><span class="line">    .isr_vector : &#x2F;*段名*&#x2F;</span><br><span class="line">    &#123;</span><br><span class="line">      . &#x3D; ALIGN(4); &#x2F;*四字节对齐*&#x2F;</span><br><span class="line">      KEEP(*(.isr_vector))  &#x2F;*所有文件的.isr_vector段都被装入这里,且这部分不能被丢弃*&#x2F;</span><br><span class="line">      . &#x3D; ALIGN(4);</span><br><span class="line">    &#125; &gt;FLASH &#x2F;*LMA在flash中*&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​	我们这里需要区分两个段名的意义，输入段的段名为我们在汇编中定义的段名，就是AREA或者.section后面的名字，输出段的段名是我们在SECTION命令中定义的，这个段名就是我们在分析c语言等输出文件结构中所谓的bss段，text段之类的东西。</p>
<h3 id="输入段描述"><a class="markdownIt-Anchor" href="#输入段描述"></a> 输入段描述</h3>
<h4 id="基本描述"><a class="markdownIt-Anchor" href="#基本描述"></a> 基本描述</h4>
<p>​	使用例子说明，参考了<a target="_blank" rel="noopener" href="https://blog.csdn.net/yubo112002/article/details/82497311">这篇blog</a>对官方文档的翻译</p>
<p>*(.text) ：表示所有输入文件的.text section</p>
<p>(*(EXCLUDE_FILE (*crtend.o*otherfile.o) .ctors)) ：表示除crtend.o、otherfile.o文件外的所有输入文件的.ctors section。</p>
<p>data.o(.data) ：表示data.o文件的.data section</p>
<p>data.o ：表示data.o文件的所有section</p>
<p>*(.text .data) ：表示所有文件的.text section和.data section，顺序是：第一个文件的.text section，第一个文件的.data section，第二个文件的.text section，第二个文件的.data section，…</p>
<p>*(.text) *(.data) ：表示所有文件的.text section和.data section，顺序是：第一个文件的.text section，第二个文件的.text section，…，最后一个文件的.text section，第一个文件的.data section，第二个文件的.data section，…，最后一个文件的.data section</p>
<p>​	注意:任何一个文件的任意section只能在SECTIONS命令内出现一次！当同一个输入文件的同一个输入段被多次包含在匹配规则中，第二次及之后会无视已经被使用过的输入段。</p>
<h4 id="common"><a class="markdownIt-Anchor" href="#common"></a> COMMON</h4>
<p>​	可以使用common段来定义通用符号，一般使用*(COMMON)来使用该输入文件（这种定义一般在输出bss段中见到，但是这里好像就和前面的不会重复包含矛盾了，等我试验下来再来）。</p>
<h4 id="垃圾回收"><a class="markdownIt-Anchor" href="#垃圾回收"></a> 垃圾回收？</h4>
<p>​	当我们启用了–gc-sections后，链接器会把他认为没用的段直接过滤掉，使用KEEP(输入文件定义)可以防止该输入段被过滤。</p>
<h4 id="直接写入数据"><a class="markdownIt-Anchor" href="#直接写入数据"></a> 直接写入数据</h4>
<p>​	我们可以使用下面的方式在某一个输出段中直接向内存中写入数据，可以帮助我们对各段进行标号~~，程序员之间传递消息的方式~~。</p>
<p>BYTE(EXPRESSION) 1 字节</p>
<p>SHORT(EXPRESSION) 2 字节</p>
<p>LOGN(EXPRESSION) 4 字节</p>
<p>QUAD(EXPRESSION) 8 字节</p>
<p>SQUAD(EXPRESSION) 64位处理器的代码时，8 字节</p>
<p>​	在使用类似</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS </span><br><span class="line">&#123; </span><br><span class="line">	.text : &#123; *(.text) LONG(1) &#125; </span><br><span class="line">	.data : &#123; *(.data) &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>的时候，链接脚本的解释器似乎会分不清楚我们的这个LONG(1)究竟是写在上面一个输出段还是下面一个输出段，我们可以通过在两个输出段中间加入&quot;. = .&quot;这样无意义的语句帮助区分。<s>这里建议自己重写链接脚本的解释器</s></p>
<h3 id="输出段描述"><a class="markdownIt-Anchor" href="#输出段描述"></a> 输出段描述</h3>
<h4 id="类型"><a class="markdownIt-Anchor" href="#类型"></a> 类型</h4>
<p>​	类型就是前面模式中的[(type)]选项，一般直接默即可，需要有所了解的是NOLOAD类型以及OVERLAY。</p>
<p>​	NOLOAD在运行时不被载入内存。</p>
<p>​	OVERLAY可以定义多个输出段在同一块内存区域，会自动的管理其内容的拷入与拷出。适用于存储器存在速度差，将内容拷贝入较快的存储器可以加快访问速度。</p>
<h4 id="设置lma"><a class="markdownIt-Anchor" href="#设置lma"></a> 设置LMA</h4>
<p>​	默认情况下，LMA等于VMA，但可以通过[AT(LMA)]项，即关键字AT()指定LMA。</p>
<p>​	用关键字AT(lma)指定，括号内包含表达式，表达式的值用于设置LMA。如果不用AT()关键字，那么可用[AT&gt;lma_region]表达式设置指定该section加载地址的范围。这个属性主要用于构件ROM境象。</p>
<h4 id="phdr-phdr"><a class="markdownIt-Anchor" href="#phdr-phdr"></a> [:phdr :phdr …]</h4>
<p>​	用于将输出段存入预先定义的程序段内，可以使用显示的重定义来覆盖该设置。这个和PHDR命令相关，要了解这个还要去看ELF格式的官方API，我太菜了，摸了。</p>
<h4 id="fillexp"><a class="markdownIt-Anchor" href="#fillexp"></a> [=FILLEXP] [,]</h4>
<p>​	用于填充输出段中的未定义区域，FILLEXP被替换为填充内容。后面的逗号用于区分，有时候会分不清楚这段有没有结束，建议加上就完事了。</p>
<h2 id="参考文献"><a class="markdownIt-Anchor" href="#参考文献"></a> 参考文献</h2>
<p>​	其实官方文档里还有很多东西，看不完了，太折磨了。基本到这里就能完全看懂stm32的链接脚本了，孩子以后一定好好学英语，哭。给点中文资料救救孩子们吧。</p>
<p>​	<a target="_blank" rel="noopener" href="https://sourceware.org/binutils/docs/ld/">ld官方文档</a></p>
<p>​	<a target="_blank" rel="noopener" href="https://blog.csdn.net/yubo112002/article/details/82497311">对官方文档的翻译做到比较好的blog</a></p>
<p>​	<a target="_blank" rel="noopener" href="https://github.com/iDalink/ld-linker-script">大佬对官方文档的重写,加了很多的实例,但是后半部分好像也摸了</a></p>
<p>​	<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Widesky/p/9089825.html">另外一个翻译版,好像和上面的翻译版内容相同</a></p>
<p>​</p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>陈星宇</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://ffyutt.github.io/2021/04/arm/linker-script.html" title="linker_script">https://ffyutt.github.io/2021/04/arm/linker-script.html</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"></div><div class="post-nav-item"><a class="post-nav-next" href="/2021/04/arm/makefile.html" rel="next" title="makefile"><span class="post-nav-text">makefile</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>要不要和我说些什么？</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> 陈星宇</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v5.4.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.5.3</span></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>